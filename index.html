<!DOCTYPE html>
<html lang="en">
<head>

    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SurgiFile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f1f5f9">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e2e8f0; /* bg-slate-200 */
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        .form-section { display: none; }
        
        /* Clock styles */
        .clock-face { stroke: #94a3b8; stroke-width: 4; fill: white; }
        .hour-marker { stroke: #94a3b8; stroke-width: 2; }
        .center-dot { fill: #1e293b; }
        .hour-text { font-size: 20px; font-weight: 500; fill: #334155; text-anchor: middle; dominant-baseline: middle; cursor: pointer; transition: fill 0.2s, font-weight 0.2s; -webkit-user-select: none; user-select: none; }
        .hour-text.disabled { cursor: not-allowed; fill: #cbd5e1; }
        .hour-text:not(.disabled):hover { fill: #0ea5e9; }
        .hour-text.selected { fill: #0284c7; font-weight: 700; }
        
        .main-marker-btn.selected, .modal-marker-btn.selected, .direction-btn.selected, .output-style-btn.selected, .justification-btn.selected, .dermoscopy-btn.selected { background-color: #0284c7; color: white; border-color: #0284c7; }
        .billing-btn.selected { background-color: #0284c7; color: white; border-color: #0284c7; }
        
        /* NEW: Rule for 'No Consult' toggle */
        /* Removed older specific button styles as we are using a toggle switch now */

        .direction-btn:disabled { background-color: #e2e8f0; color: #94a3b8; cursor: not-allowed; }

        /* Style for missing required fields */
        .missing-field {
            border-color: #ef4444 !important; /* red-500 */
            background-color: #fef2f2 !important; /* red-50 (Very light red background) */
            --tw-ring-color: #ef4444;
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
            transition: all 0.2s ease-in-out;
        }

        /* Shake Animation for Errors */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        /* Tab Styles */
        .tab-btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            color: #334155; /* text-slate-700 */
            background-color: #f1f5f9; /* bg-slate-100 */
            transition: all 0.2s;
        }
        .tab-btn:hover {
            background-color: #e2e8f0; /* bg-slate-200 */
        }
        .tab-btn.active {
            color: white;
            background-color: #0284c7; /* bg-sky-600 */
        }
        /* Icon Button (Cog) */
        .icon-btn {
             color: #475569; /* text-slate-600 */
             padding: 8px;
             border-radius: 8px;
             background-color: #f1f5f9; /* bg-slate-100 */
             transition: all 0.2s;
        }
        .icon-btn:hover {
            background-color: #e2e8f0; /* bg-slate-200 */
        }
        .icon-btn.active {
            color: white;
            background-color: #0284c7; /* bg-sky-600 */
        }
        
        .app-view {
            display: none; /* Hidden by default */
        }
        .app-view.active {
            display: block; /* Shown by JS */
        }

        /* --- Toggle Switch Styles (for Settings page) --- */
        .toggle-switch-container {
            display: flex;
            align-items: center;
            gap: 0.75rem; /* gap-3 */
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1; /* bg-slate-300 */
            transition: .4s;
            border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #0284c7; /* bg-sky-600 */
        }
        input:focus + .toggle-slider {
            box-shadow: 0 0 1px #0284c7;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        /* --- End Toggle Switch Styles --- */


        /* Billing View File List Styles */
        .file-list-item {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .file-list-item:hover {
            background-color: #f8fafc; /* bg-slate-50 */
        }

        /* Billing Column Colors & Layout */
        .billing-column-header {
            border-bottom-width: 4px;
            padding-bottom: 8px;
            cursor: pointer;
        }
        .col-header-unprocessed { border-color: #f59e0b; } /* amber-500 */
        .col-header-billed { border-color: #3b82f6; } /* blue-500 */
        .col-header-archive { border-color: #94a3b8; } /* slate-400 */

        /* Single Column & Collapsible Logic */
        .billing-list-section {
            max-height: 45vh; /* Set max height for scroll */
            overflow-y: auto;
            transition: all 0.3s ease-in-out;
            border-width: 1px;
            padding: 4px;
            margin-top: 1rem;
            border-color: #e2e8f0; /* bg-slate-200 */
        }
        .billing-list-section.collapsed {
            max-height: 0;
            overflow: hidden;
            border-width: 0;
            padding: 0;
            margin-top: 0;
        }
        
        /* --- Role-Specific UI --- */
        
        /* When in Doctor Mode... */
        .doctor-mode-active #billing-columns {
            /* (Defaults are set in app.js: unprocessed open, others collapsed) */
        }

        /* When in PM Mode... */
        .pm-mode-active #unprocessed-section {
            display: none; /* Hide the unprocessed section for PMs */
        }
        .pm-mode-active #print-billed-list-btn {
             display: inline-flex; /* Show the print button for PMs */
        }
        .pm-mode-active #batch-archive-container {
            display: block; /* Show batch archive button */
        }
        .pm-mode-active #select-all-btn {
            display: inline-flex; /* Show select all button */
        }
        .pm-mode-active #send-back-btn {
            display: inline-flex; /* Show send back button */
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            #printable-report, #printable-report * {
                visibility: visible;
            }
            #printable-report {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                font-size: 12px; /* Set a base font size for print */
                color: #000;
            }
            /* These styles will apply to the new list format */
            #printable-report h1, #printable-report h2, #printable-report div {
                visibility: visible;
            }
            @page {
                size: auto;
                margin: 20mm;
            }
        }
        #printable-report {
            display: none; /* Hidden by default, only shown for printing */
        }

        /* Billing Assistant Suggestion Style */
        .billing-suggestion {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f1f5f9; /* bg-slate-100 */
            padding: 8px 12px;
            border-radius: 8px;
            border: 2px solid #f1f5f9;
            transition: all 0.2s;
        }
        .billing-suggestion.confirmed {
            border-color: #0284c7; /* border-sky-600 */
            background-color: #f0f9ff; /* bg-sky-50 */
        }
        .billing-suggestion.disabled {
            background-color: #f8fafc; /* bg-slate-50 */
            opacity: 0.7;
        }
        .billing-suggestion .confirm-btn {
            background-color: #0ea5e9; /* bg-sky-500 */
            color: white;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .billing-suggestion .confirm-btn:hover {
            background-color: #0284c7; /* bg-sky-600 */
        }
        /* Style for "Remove" button state */
        .billing-suggestion.confirmed .confirm-btn {
            background-color: #dc2626; /* bg-red-600 */
        }
        .billing-suggestion.confirmed .confirm-btn:hover {
            background-color: #b91c1c; /* bg-red-700 */
        }
        
        .billing-suggestion .confirm-btn:disabled {
            background-color: #94a3b8; /* bg-slate-400 */
            cursor: not-allowed;
        }
        
        /* Billing-Only Mode Toggle (driven by class on entry-form-container) */
        .billing-only-mode #full-clinical-fields {
            display: none !important;
        }
        .billing-only-mode #final-defect-size-container {
             display: block !important;
        }
        /* NEW: Hide clinical audit fields in manual billing mode */
        .billing-only-mode #clinical-audit-fields {
            display: none !important;
        }
         /* NEW: Hide pathology in manual billing mode */
        .billing-only-mode #pathology-container {
            display: none !important;
        }
        /* NEW: Show procedure date in manual billing mode */
        .billing-only-mode #procedure-date-container {
             display: block !important;
        }


    </style>
</head>
<body class="bg-slate-200 text-slate-800">

    <nav class="bg-white shadow-md w-full p-4 sticky top-0 z-40">
        <div class="container mx-auto flex items-center justify-between">
            
            <div class="flex items-center gap-4">
                <!-- App Icon -->
                <img src="icon-192.png" alt="SurgiFile Logo" class="h-10 w-10 rounded-lg">
                <h1 id="app-title" class="text-2xl font-bold text-slate-700">SurgiFile</h1>
            </div>
            
            <div class="flex items-center gap-4">
                <!-- Tab Buttons -->
                <button id="tab-clinical-note" class="tab-btn active">Clinical Note Entry</button>
                <button id="tab-manual-billing" class="tab-btn">Add Manual Billing</button>
                <button id="tab-billing" class="tab-btn">Billing & Processing</button>
                
                <div class="w-px h-8 bg-slate-300"></div> <!-- Divider -->

                <!-- Doctor Dropdown (now controlled by PM mode) -->
                <div id="nav-doctor-dropdown-container" class="active">
                     <select id="nav-doctor-dropdown" class="bg-slate-100 border border-slate-300 rounded-lg p-2 font-medium text-slate-700"></select>
                </div>
                
                <!-- NEW: Settings Cogwheel Button -->
                <button id="tab-settings" class="icon-btn" aria-label="Settings">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311a1.464 1.464 0 0 1-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.858 2.929 2.929 0 0 1 0 5.858z"/>
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <div id="entry-view" class="app-view active">
        <div class="container mx-auto p-4 md:p-8 max-w-7xl">
            <header class="text-center mb-8 p-6 bg-white rounded-2xl shadow-lg">
                <h1 id="entry-view-header-title" class="text-3xl md:text-4xl font-bold text-slate-700">Clinical Note Generator</h1>
                <p id="entry-view-subtitle" class="text-slate-500 mt-2">Part 1: Enter full clinical data and generate the operation note.</p>
            </header>
            
            <!-- This container will be used to hide/show sections -->
            <div id="entry-form-container">
                <div id="entry-grid-container" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <form id="lesion-form">
                            
                            <div class="space-y-4 border-b border-slate-200 pb-6 mb-6">
                                <h2 class="text-2xl font-semibold">Procedure Details</h2>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="md:col-span-2">
                                        <label for="patientName" class="block text-sm font-medium text-slate-600 mb-2">Patient Name</label>
                                        <input type="text" id="patientName" placeholder="e.g., John Smith" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3">
                                    </div>
                                    <div>
                                        <label for="patientDOB" class="block text-sm font-medium text-slate-600 mb-2">Patient Date of Birth</label>
                                        <input type="date" id="patientDOB" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3">
                                    </div>
                                    <!-- NEW: Procedure Date Input (for manual billing) -->
                                    <div id="procedure-date-container" class="hidden">
                                        <label for="procedureDate" class="block text-sm font-medium text-slate-600 mb-2">Procedure Date</label>
                                        <input type="date" id="procedureDate" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3">
                                    </div>
                                </div>
                            </div>
                            
                            <h2 class="text-2xl font-semibold mb-4" id="form-title">Enter Lesion Details</h2>
            
                            <div>
                                <label for="procedureType" class="block text-sm font-medium text-slate-600 mb-2">1. Procedure Type</label>
                                <select id="procedureType" name="procedureType" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                                    <option value="" disabled selected>Select a procedure...</option>
                                    <option value="Excision">Excision</option>
                                    <option value="Punch">Punch</option>
                                    <option value="Shave">Shave</option>
                                    <option value="Wedge Excision">Wedge Excision</option>
                                </select>
                            </div>
            
                            <div id="dynamic-options-container" class="mt-6 space-y-4 border-t border-slate-200 pt-6">
                                
                                <!-- Common Fields (for both modes) -->
                                <div>
                                    <label for="lesionLocation" class="block text-sm font-medium text-slate-600 mb-2">Lesion Location Description</label>
                                    <input type="text" id="lesionLocation" name="lesionLocation" placeholder="e.g., Left forearm, 10cm proximal to wrist" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3">
                                </div>
                
                                <div>
                                    <label for="anatomicalRegion" class="block text-sm font-medium text-slate-600 mb-2">Anatomical Region (for billing)</label>
                                    <select id="anatomicalRegion" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3">
                                        <option value="">Select billing region...</option>
                                        <!-- Compliant Area Definitions -->
                                        <option value="Area1">Area 1: Nose, eyelid, eyebrow, lip, ear, digit, genitalia (or contiguous)</option>
                                        <option value="Area2">Area 2: Face, neck, scalp, nipple, distal limbs (from knee/ulnar styloid)</option>
                                        <option value="Area3">Area 3: Trunk, proximal limbs (areas not in 1 or 2)</option>
                                    </select>
                                </div>
                                
                                <!-- Container for clinical-only fields -->
                                <div id="pathology-container">
                                    <label class="block text-sm font-medium text-slate-600 mb-2">Provisional Diagnosis (PDx)</label>
                                    <div class="flex items-center gap-2">
                                        <div id="pathologyDisplay" class="flex-grow bg-slate-100 border border-slate-300 rounded-lg p-3 h-12 flex items-center text-slate-500 italic cursor-pointer">Click to select...</div>
                                        <input type="hidden" id="provisionalDiagnoses">
                                    </div>
                                </div>
                                
                                <!-- Container for clinical-only audit fields -->
                                <div id="clinical-audit-fields" class="space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <label class="flex items-center space-x-2 font-medium text-slate-700">
                                            <input type="checkbox" id="excludeNMSC" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <span>Exclude NMSC?</span>
                                        </label>
                                        <label class="flex items-center space-x-2 font-medium text-slate-700">
                                            <input type="checkbox" id="excludeMelanoma" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <span>Exclude Melanoma?</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-600 mb-2">Dermoscopy Used?</label>
                                        <div id="dermoscopy-btn-container" class="flex gap-2">
                                            <button type="button" class="dermoscopy-btn w-full bg-slate-200 text-slate-700 font-bold py-2 px-3 rounded-lg hover:bg-slate-300 text-sm" data-value="Y">Yes</button>
                                            <button type="button" class="dermoscopy-btn w-full bg-slate-200 text-slate-700 font-bold py-2 px-3 rounded-lg hover:bg-slate-300 text-sm" data-value="N">No</button>
                                        </div>
                                        <input type="hidden" id="dermoscopyUsed">
                                    </div>
                                </div>


                                <!-- Billing-Only Mode Field -->
                                <div id="final-defect-size-container" class="form-section">
                                    <label for="finalDefectSize" class="block text-sm font-medium text-slate-600 mb-2">Final Defect Size (mm)</label>
                                    <input type="number" id="finalDefectSize" placeholder="Enter final defect diameter" class="w-full bg-slate-50 border rounded-lg p-3">
                                </div>
                                
                                <!-- Procedure-Specific Fields -->
                                <div id="excision-options" class="form-section space-y-4">
                                    <label for="excisionClosureType" class="block text-sm font-medium text-slate-600 mb-2">Excision Closure Method</label>
                                    <select id="excisionClosureType" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3">
                                        <option value="Ellipse">Ellipse</option>
                                        <option value="Secondary Intention">Secondary Intention</option>
                                        <option value="Flap Repair">Flap Repair</option>
                                        <option value="Graft Repair">Graft Repair</option>
                                        <option value="Graft + Flap">Graft + Flap</option>
                                    </select>
                                </div>
                                <div id="punch-options" class="form-section">
                                    <label for="punchType" class="block text-sm font-medium text-slate-600 mb-2">Punch Type</label>
                                    <select id="punchType" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3">
                                        <option value="Punch Biopsy">Punch Biopsy</option>
                                        <option value="Punch Excision">Punch Excision</option>
                                    </select>
                                </div>
                                <div id="graft-type-container" class="form-section">
                                    <label for="graftType" class="block text-sm font-medium text-slate-600 mb-2">Graft Type</label>
                                    <select id="graftType" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3">
                                        <option value="Split-Skin Graft (SSG)">Split-Skin Graft (SSG)</option>
                                        <option value="Full-Thickness Skin Graft (FTSG)">Full-Thickness Skin Graft (FTSG)</option>
                                    </select>
                                </div>

                                <!-- Full Clinical Mode Fields -->
                                <div id="full-clinical-fields" class="form-section space-y-4">
                                    <div id="justification-container" class="form-section space-y-2">
                                        <label class="block text-sm font-medium text-slate-600">Justification for Flap/Graft</label>
                                        <div id="justification-buttons" class="flex flex-wrap gap-2">
                                            <button type="button" class="justification-btn text-xs bg-sky-100 text-sky-800 px-2 py-1 rounded-full hover:bg-sky-200" data-text="Defect size/tension prevents primary closure.">Size/Tension</button>
                                            <button type="button" class="justification-btn text-xs bg-sky-100 text-sky-800 px-2 py-1 rounded-full hover:bg-sky-200" data-text="Anatomical location with poor skin laxity.">Location</button>
                                            <button type="button" class="justification-btn text-xs bg-sky-100 text-sky-800 px-2 py-1 rounded-full hover:bg-sky-200" data-text="To avoid distortion of adjacent anatomical features.">Avoid Distortion</button>
                                            <button type="button" class="justification-btn text-xs bg-sky-100 text-sky-800 px-2 py-1 rounded-full hover:bg-sky-200" data-text="To preserve cosmetic appearance (color/texture/contour).">Cosmesis</button>
                                            <button type="button" class="justification-btn text-xs bg-sky-100 text-sky-800 px-2 py-1 rounded-full hover:bg-sky-200" data-text="To maintain mobility over a joint.">Mobility</button>
                                        </div>
                                        <input type="hidden" id="flapGraftJustification">
                                    </div>
                                    <div>
                                        <label for="localAnesthetic" class="block text-sm font-medium text-slate-600 mb-2">Local Anesthetic</label>
                                        <select id="localAnesthetic" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3">
                                            <option value="Lignocaine 1% with Adrenaline 1:100,000">Lignocaine 1% w/ Adrenaline</option>
                                            <option value="Lignocaine 1% without Adrenaline">Lignocaine 1% Plain</option>
                                            <option value="Bupivacaine 0.5%">Bupivacaine 0.5%</option>
                                        </select>
                                    </div>
                                    <div id="lesion-size-container" class="form-section">
                                        <label class="block text-sm font-medium text-slate-600 mb-2">Lesion Dimensions (mm)</label>
                                        <div class="grid grid-cols-2 gap-4">
                                            <input type="number" id="lesionLength" placeholder="Length" class="w-full bg-slate-50 border rounded-lg p-3">
                                            <input type="number" id="lesionWidth" placeholder="Width" class="w-full bg-slate-50 border rounded-lg p-3">
                                        </div>
                                    </div>
                                    <div id="margin-container" class="form-section">
                                        <label for="margin" class="block text-sm font-medium text-slate-600 mb-2">Clinical Margin (mm)</label>
                                        <input type="number" id="margin" placeholder="e.g., 4" class="w-full bg-slate-50 border rounded-lg p-3">
                                    </div>
                                    <div id="punch-size-container" class="form-section">
                                        <label for="punchSize" class="block text-sm font-medium text-slate-600 mb-2">Punch Biopsy Size (mm)</label>
                                        <input type="number" id="punchSize" name="punchSize" placeholder="e.g., 3" class="w-full bg-slate-50 border rounded-lg p-3">
                                    </div>
                                </div>

                                <!-- Orientation Input (Full clinical mode only) -->
                                <div id="orientation-input-container" class="form-section">
                                    <label class="block text-sm font-medium text-slate-600 mb-2">Specimen Orientation</label>
                                    <div id="main-marker-btn-container" class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                        <button type="button" class="main-marker-btn bg-slate-200 text-slate-700 font-bold py-2 px-3 rounded-lg hover:bg-slate-300 text-sm" data-value="None">None</button>
                                        <button type="button" class="main-marker-btn bg-slate-200 text-slate-700 font-bold py-2 px-3 rounded-lg hover:bg-slate-300 text-sm" data-value="Nick">Nick</button>
                                        <button type="button" class="main-marker-btn bg-slate-200 text-slate-700 font-bold py-2 px-3 rounded-lg hover:bg-slate-300 text-sm" data-value="Apex">Apex</button>
                                        <button type="button" class="main-marker-btn bg-slate-200 text-slate-700 font-bold py-2 px-3 rounded-lg hover:bg-slate-300 text-sm" data-value="Suture">Suture</button>
                                    </div>
                                    <input type="hidden" id="orientationType" value="None">
                                    <input type="hidden" id="orientationDescription">
                                </div>
                                
                                <!-- Closure Details (Full clinical mode only) -->
                                <div id="closure-details-container" class="form-section space-y-4 pt-4 border-t mt-4">
                                        <h3 class="text-lg font-semibold text-slate-600">Closure Details</h3>
                                        <div class="space-y-2 p-3 bg-slate-50 rounded-lg">
                                            <label class="flex items-center space-x-2 font-medium text-slate-700">
                                                <input type="checkbox" id="useDeepSuture" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                <span>Use Deep Sutures (Optional)</span>
                                             </label>
                                             <div id="deep-suture-container" class="hidden grid grid-cols-2 gap-4 pt-2">
                                                 <select id="deepSutureSize" class="w-full bg-white border border-slate-300 rounded-lg p-3">
                                                    <option value="3/0">3/0</option>
                                                    <option value="4/0" selected>4/0</option>
                                                    <option value="5/0">5/0</option>
                                                 </select>
                                                 <select id="deepSutureType" class="w-full bg-white border border-slate-300 rounded-lg p-3">
                                                    <!-- Options populated by settings-view.js -->
                                                 </select>
                                             </div>
                                         </div>
                                         <div class="space-y-2 p-3 bg-slate-50 rounded-lg">
                                            <label class="flex items-center space-x-2 font-medium text-slate-700">
                                                <input type="checkbox" id="useSkinSuture" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                                                <span>Use Skin Sutures</span>
                                             </label>
                                             <div id="skin-suture-details" class="grid grid-cols-2 gap-4 pt-2">
                                                 <select id="skinSutureSize" class="w-full bg-white border border-slate-300 rounded-lg p-3">
                                                     <option value="3/0">3/0</option>
                                                     <option value="4/0">4/0</option>
                                                     <option value="5/0" selected>5/0</option>
                                                     <option value="6/0">6/0</option>
                                                 </select>
                                                 <select id="skinSutureType" class="w-full bg-white border border-slate-300 rounded-lg p-3">
                                                     <!-- Options populated by settings-view.js -->
                                                 </select>
                                                 <div id="skin-suture-removal-container" class="col-span-2 hidden">
                                                     <input type="number" id="removalOfSkinSutures" placeholder="Suture Removal (days)" class="w-full bg-white border border-slate-300 rounded-lg p-3">
                                                 </div>
                                             </div>
                                         </div>
                                </div>
            
                            </div>
                        </form>
                        
                        <div class="mt-8 pt-6 border-t border-slate-200">
                            <div class="flex flex-col sm:flex-row gap-3">
                                <button id="add-lesion-btn" type="button" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md disabled:bg-slate-300">
                                    Add Lesion
                                </button>
                                <button id="cancel-edit-btn" type="button" class="w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition duration-300 shadow-md hidden">
                                    Cancel Edit
                                </button>
                            </div>
                            
                            <div class="mt-6 flex flex-col sm:flex-row gap-3">
                                <button id="save-procedure-btn" type="button" class="w-full bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-emerald-700 transition duration-300 shadow-md">
                                    Save Procedure to Billing
                                </button>
                                <button id="clear-procedure-btn" type="button" class="w-full sm:w-auto bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 transition duration-300">
                                    Clear Procedure
                                </button>
                            </div>
            
                        </div>
                    </div>
            
                    <!-- Right Column (Lesions List, Request, Note) -->
                    <div id="entry-right-column">
                        <div id="recorded-lesions-wrapper" class="bg-white p-6 rounded-2xl shadow-lg mb-8">
                            <h2 class="text-2xl font-semibold mb-4 border-b pb-3">Recorded Lesions for this Patient</h2>
                            <div id="lesions-list" class="space-y-3">
                                <p class="text-slate-500 italic">No lesions added yet.</p>
                            </div>
                        </div>
            
                        <div id="output-style-btn-container" class="flex items-center gap-4 mb-4">
                            <label class="text-sm font-medium text-slate-600">Output Style:</label>
                            <div class="flex gap-2">
                                <button id="output-btn-combined" class="output-style-btn px-3 py-1 text-sm rounded-md bg-slate-200 text-slate-700" data-value="combined">Combined</button>
                                <button id="output-btn-separate" class="output-style-btn px-3 py-1 text-sm rounded-md bg-slate-200 text-slate-700" data-value="separate">Separate</button>
                            </div>
                        </div>
            
                        <div id="clinical-request-wrapper" class="bg-white p-6 rounded-2xl shadow-lg mb-8">
                            <div class="flex justify-between items-center mb-4 border-b pb-3">
                                <h2 class="text-2xl font-semibold">Clinical Request</h2>
                                <button id="copy-request-btn" class="bg-sky-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-600 transition duration-300 flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3z"/></svg>
                                    <span id="copy-request-btn-text">Copy</span>
                                </button>
                            </div>
                            <textarea id="clinicalRequestOutput" rows="8" class="w-full bg-slate-50 border-none rounded-lg p-4 text-sm leading-6 focus:ring-0" readonly>Your clinical request will appear here...</textarea>
                        </div>
                        
                        <div id="generated-note-wrapper" class="bg-white p-6 rounded-2xl shadow-lg sticky top-8">
                            <div class="flex justify-between items-center mb-4 border-b pb-3">
                                <h2 class="text-2xl font-semibold">Generated Note</h2>
                                <button id="copy-note-btn" class="bg-emerald-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-emerald-600 transition duration-300 flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3z"/></svg>
                                    <span id="copy-note-btn-text">Copy</span>
                                </button>
                            </div>
                            <textarea id="entryNoteOutput" rows="18" class="w-full bg-slate-50 border-none rounded-lg p-4 text-sm leading-6 focus:ring-0" readonly>Your generated note will appear here...</textarea>
                        </div>
                    </div>
                </div>
            </div> <!-- End of entry-form-container -->
    
            <footer class="text-center mt-12">
                <p class="text-xs text-slate-500">
                    Disclaimer: This tool is intended for educational and informational purposes only and does not constitute medical advice. The author makes no warranties regarding the accuracy, completeness, or reliability of the information provided and is not liable for any claims or damages arising from its use. Use at your own risk.
                </p>
            </footer>
        </div>
    </div>

    <div id="billing-view" class="app-view">
        <div id="billing-view-container" class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="mb-8 p-6 bg-white rounded-2xl shadow-lg">
                <div class="flex justify-between items-center">
                    <h1 id="billing-title" class="text-3xl md:text-4xl font-bold text-slate-700">Billing & Processing</h1>
                </div>
                
                <div class="mt-6 pt-4 border-t flex items-center justify-between gap-4">
                    <div class="flex-grow">
                        <input type="text" id="search-bar" placeholder="Search by patient name..." class="w-full bg-slate-100 border border-slate-300 rounded-lg p-2">
                    </div>
                    <div class="flex-shrink-0 flex gap-2">
                         <!-- ADDED: Button for printing unprocessed list (Doctor view) -->
                         <button id="print-unprocessed-list-btn" class="hidden bg-amber-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-amber-700 transition duration-300">
                            Print Work List
                        </button>
                         <button id="print-billed-list-btn" class="hidden bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition duration-300">
                            Print Ready List
                        </button>
                        <button id="load-files-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300">
                            Refresh Database
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Single-Column Layout -->
            <div id="billing-columns" class="space-y-6">
                
                <!-- UNPROCESSED SECTION -->
                <div id="unprocessed-section">
                    <h2 id="unprocessed-header" class="text-2xl font-semibold text-amber-700 billing-column-header col-header-unprocessed flex justify-between items-center">
                        <span>Unprocessed</span>
                        <span id="unprocessed-count-dash" class="text-xl font-bold ml-2"></span>
                    </h2>
                    <div id="unprocessed-list" class="billing-list-section space-y-3 p-1 mt-4">
                        <!-- List items here -->
                    </div>
                </div>
    
                <!-- BILLED / "Ready to Bill" SECTION -->
                <div id="billed-section">
                    <h2 id="billed-header" class="text-2xl font-semibold text-blue-700 billing-column-header col-header-billed flex justify-between items-center">
                        <span>Ready to Bill</span>
                        <span id="billed-count-dash" class="text-xl font-bold ml-2"></span>
                    </h2>
                    <div id="batch-archive-container" class="hidden my-4 p-4 bg-slate-100 rounded-lg flex justify-between items-center">
                        <button id="select-all-btn" class="hidden bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-300">
                            Select All
                        </button>
                        <button id="batch-archive-btn" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-700 transition duration-300 disabled:bg-slate-400">
                            Batch Archive Selected Items
                        </button>
                    </div>
                    <div id="billed-list" class="billing-list-section space-y-3 p-1 mt-0">
                         <!-- List items here -->
                    </div>
                </div>
    
                <!-- ARCHIVE SECTION -->
                <div id="archive-section">
                    <h2 id="archive-header" class="text-2xl font-semibold text-slate-700 billing-column-header col-header-archive flex justify-between items-center">
                        <span>Archive</span>
                        <span id="archive-count-dash" class="text-xl font-bold ml-2"></span>
                    </h2>
                    <div class="my-4">
                        <input type="text" id="archive-search" placeholder="Search archive by patient..." class="w-full bg-slate-100 border border-slate-300 rounded-lg p-2">
                    </div>
                    <div id="archive-list" class="billing-list-section space-y-3 p-1 mt-0">
                         <!-- List items here -->
                    </div>
                </div>
            </div>

            <div id="billing-panel" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
                <div class="w-full max-w-2xl bg-white p-6 rounded-2xl shadow-lg max-h-[90vh] flex flex-col">
                    <div class="flex justify-between items-center mb-4 border-b pb-3">
                        <h2 class="text-2xl font-bold text-slate-700" id="billing-panel-title">Billing Panel</h2>
                        <button id="close-billing-panel-btn" class="text-slate-500 hover:text-slate-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M.293.293a1 1 0 0 1 1.414 0L8 6.586 14.293.293a1 1 0 1 1 1.414 1.414L9.414 8l6.293 6.293a1 1 0 0 1-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L6.586 8 .293 1.707a1 1 0 0 1 0-1.414z"/></svg>
                        </button>
                    </div>
                    
                    <!-- Content area -->
                    <div class="overflow-y-auto space-y-4 pr-2">
                         <div id="billing-assistant-lesions" class="space-y-4">
                            <!-- Lesion cards injected here -->
                         </div>
                        <hr/>
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label for="billing-consult-item" id="billing-consult-label" class="block text-sm font-medium text-slate-600">Consult Item</label>
                                
                                <!-- CHANGED: Restored Toggle Switch Structure with ID for container -->
                                <div id="consult-toggle-container" class="flex items-center gap-2">
                                    <span class="text-sm text-slate-500 font-medium">Bill Consult?</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="consult-toggle">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <!-- Input is hidden if toggle is OFF -->
                            <input type="text" id="billing-consult-item" placeholder="e.g., 23" class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3 transition-all duration-200">
                            <p id="consult-disabled-msg" class="text-sm text-slate-400 italic mt-1 hidden">Consult billing disabled.</p>
                        </div>
                         <div>
                            <label for="billing-comment" class="block text-sm font-medium text-slate-600 mb-2">Billing Comment (Optional)</label>
                            <textarea id="billing-comment" rows="2" placeholder="e.g., Patient has concession card." class="w-full bg-slate-50 border border-slate-300 rounded-lg p-3"></textarea>
                        </div>
                    </div>

                    <!-- Panel Action Buttons -->
                    <div id="billing-panel-doctor-actions" class="mt-6 flex gap-3">
                        <button id="edit-procedure-btn" class="w-auto bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300">Edit</button>
                        <button id="save-as-billed-btn" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition duration-300">Save as Billed</button>
                        <button id="delete-procedure-btn" class="w-auto bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition duration-300">Delete</button>
                    </div>
                    <div id="billing-panel-pm-actions" class="mt-6 flex gap-3 hidden">
                        <button id="send-back-btn" class="hidden w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-amber-700 transition duration-300">Send Back to Doctor</button>
                        <button id="move-to-archive-btn" class="w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition duration-300">Archive this one item</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div id="settings-view" class="app-view">
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="text-center mb-8 p-6 bg-white rounded-2xl shadow-lg">
                <h1 class="text-3xl md:text-4xl font-bold text-slate-700">Settings</h1>
                <p class="text-slate-500 mt-2">Manage app data, including billing codes and doctor folders.</p>
            </header>
            
            <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
                <h2 class="text-2xl font-semibold mb-4">Mode</h2>
                <div class="toggle-switch-container">
                    <label for="pm-mode-toggle-settings" class="font-semibold text-slate-700 text-lg">Practice Manager Mode</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="pm-mode-toggle-settings">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                 <p class="text-sm text-slate-500 mt-2">Activates Practice Manager view, hiding clinical entry tabs and enabling multi-doctor billing.</p>
            </div>
            
             <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
                <h2 class="text-2xl font-semibold mb-4">Step 1: Set Database Folder</h2>
                <button id="set-save-folder-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300">
                    Set Database Folder
                </button>
                <p id="folder-status-msg" class="text-sm text-slate-500 mt-2">Status: No database folder set.</p>
            </div>

             <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
                <h2 class="text-2xl font-semibold mb-4">Step 2: Manage Doctors</h2>
                <p class="text-sm text-slate-600 mb-4">
                    Add a new doctor by entering their name. This will create a new set of folders in your Database Folder.
                </p>
                <div class="flex items-center gap-2">
                    <span class="font-semibold text-slate-700">Dr.</span>
                    <input type="text" id="new-doctor-name" placeholder="Firstname Lastname" class="flex-grow bg-slate-50 border border-slate-300 rounded-lg p-3">
                    <button id="add-doctor-btn" class="bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-emerald-700 transition duration-300">
                        Add Doctor
                    </button>
                </div>
                 <p id="add-doctor-status" class="text-sm mt-2"></p>
            </div>
            
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-4">App Settings Editor (Billing Codes)</h2>
                <p class="text-sm text-slate-600 mb-4">
                    Edit the JSON data below to update, add, or remove billing codes and suture types.
                    <br><strong>Warning:</strong> Invalid JSON will break the application. Use a JSON validator if unsure.
                </p>
                <textarea id="app-settings-editor" rows="30" class="w-full bg-slate-100 border border-slate-300 rounded-lg p-4 text-sm font-mono focus:ring-2 focus:ring-blue-500"></textarea>
                <div class="mt-4 flex justify-end gap-3">
                    <button id="reset-app-settings-btn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition duration-300">Reset to Defaults</button>
                    <button id="save-app-settings-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300">Save Changes</button>
                </div>
                <p id="app-settings-status" class="text-sm mt-2"></p>
            </div>
        </div>
    </div>
    
    <div id="pathologyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="w-full max-w-md bg-white p-6 rounded-2xl shadow-lg">
            <h2 class="text-xl font-bold text-slate-700 mb-4">Select Provisional Diagnoses</h2>
            <div id="pathology-checkboxes" class="grid grid-cols-2 gap-2 max-h-[50vh] overflow-y-auto pr-2">
                </div>
            <div class="mt-4">
                <input type="text" id="otherPathologyInput" class="w-full bg-slate-50 border rounded-lg p-2" placeholder="Other diagnosis...">
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button type="button" id="confirmPathologyBtn" class="bg-emerald-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-emerald-600">Confirm</button>
            </div>
        </div>
    </div>

    <div id="orientationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="w-full max-w-lg bg-white p-6 md:p-8 rounded-2xl shadow-lg transform transition-all" id="modal-content">
            <h1 class="text-2xl font-bold text-slate-700 text-center mb-6">Select Orientation Location</h1>
            
            <div id="modal-location-selector">
                <div class="mb-6">
                    <svg id="clock" viewBox="0 0 200 200" class="w-full max-w-xs mx-auto"></svg>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-6">
                    <button class="direction-btn w-full bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 transition duration-300" data-value="Superior">Superior</button>
                    <button class="direction-btn w-full bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 transition duration-300" data-value="Inferior">Inferior</button>
                    <button class="direction-btn w-full bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 transition duration-300" data-value="Medial">Medial</button>
                    <button class="direction-btn w-full bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 transition duration-300" data-value="Lateral">Lateral</button>
                    <button class="direction-btn w-full bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 transition duration-300" data-value="Anterior">Anterior</button>
                    <button class="direction-btn w-full bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 transition duration-300" data-value="Posterior">Posterior</button>
                    <button class="direction-btn w-full bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 transition duration-300" data-value="Proximal">Proximal</button>
                    <button class="direction-btn w-full bg-slate-200 text-slate-700 font-bold py-3 px-4 rounded-lg hover:bg-slate-300 transition duration-300" data-value="Distal">Distal</button>
                </div>
            </div>
            
            <div class="flex justify-end gap-3">
                 <button type="button" id="cancelOrientationBtn" class="bg-slate-200 text-slate-700 font-bold py-2 px-4 rounded-lg hover:bg-slate-300">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Printable Report (Hidden by default) -->
    <div id="printable-report" class="p-4">
        <h1 id="print-title" class="text-2xl font-bold mb-4"></h1>
        <!-- Content injected by JS -->
    </div>

    <!-- ==== REUSABLE TOAST ALERT (Bottom Right) ==== -->
    <!-- Changed: Removed bg-opacity-60 backdrop, changed positioning to bottom-right -->
    <div id="appAlertModal" class="fixed bottom-5 right-5 z-50 hidden transition-opacity duration-500 ease-in-out opacity-0">
        <div class="max-w-sm bg-white p-4 rounded-xl shadow-2xl border-l-4 border-slate-500 flex items-start gap-3" id="appAlertContent">
            <div id="appAlertIconContainer" class="flex-shrink-0 pt-1">
                <!-- Icon will be injected by JS -->
            </div>
            <div class="flex-grow">
                <h2 id="appAlertTitle" class="font-bold text-slate-800 text-sm mb-1">Alert</h2>
                <p id="appAlertMessage" class="text-slate-600 text-sm">This is an alert message.</p>
            </div>
            <!-- Small close button for early dismissal -->
            <button type="button" id="appAlertOkBtn" class="text-slate-400 hover:text-slate-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8 8.707l-2.646 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>
            </button>
        </div>
    </div>
    
    <!-- ==== REUSABLE CONFIRM MODAL (Stays Centered) ==== -->
    <div id="appConfirmModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
        <div class="w-full max-w-md bg-white p-6 rounded-2xl shadow-lg">
             <div class="flex items-center gap-3 mb-4">
                <div id="appConfirmIconContainer" class="flex-shrink-0">
                    <!-- Icon will be injected by JS -->
                </div>
                <h2 id="appConfirmTitle" class="text-xl font-bold text-slate-700">Please Confirm</h2>
            </div>
            <p id="appConfirmMessage" class="text-slate-600 mb-6">Are you sure you want to do this?</p>
            <div class="flex justify-end gap-3 mt-6">
                <button type="button" id="appConfirmCancelBtn" class="bg-slate-200 text-slate-700 font-bold py-2 px-4 rounded-lg hover:bg-slate-300">Cancel</button>
                <button type="button" id="appConfirmOkBtn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700">Confirm</button>
            </div>
        </div>
    </div>

    <!-- 
      NEW SCRIPT LOAD ORDER
      All logic is now modularized and loaded in order.
      - app.js: Global state, variables, and core logic
      - db.js: IndexedDB helpers (runs early)
      - file-system.js: File system logic (depends on db.js)
      - settings-view.js: App settings, billing codes
      - entry-view.js: Logic for the entry tab
      - billing-view.js: Logic for the billing tab
      - modals.js: Logic for popup modals
      - events.js: Attaches all event listeners (runs last)
    -->
    <script src="app.js"></script>
    <script src="db.js"></script>
    <script src="file-system.js"></script>
    <script src="settings-view.js"></script>
    <script src="entry-view.js"></script>
    <script src="billing-view.js"></script>
    <script src="modals.js"></script>
    <script src="events.js"></script>
    
</body>
</html>
